# üìê –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞—Å—á–µ—Ç—É –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π Dashboard

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ø–æ–Ω—è—Ç—å, –∫–∞–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ Dashboard, –∏ –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ë–î.

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –î–ó

### 1. `totalReceivables` (–û–±—â–∞—è –¥–µ–±–∏—Ç–æ—Ä—Å–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å)

**–§–æ—Ä–º—É–ª–∞:**
```
totalReceivables = Œ£ (totalAmount - paidAmount)
–≥–¥–µ:
  - status != 'PAID'
  - outstandingAmount > 0
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –í—ã–≥—Ä—É–∑–∏—Ç–µ –≤—Å–µ —Å—á–µ—Ç–∞ –∏–∑ –ë–î: `db.invoices.find({ status: { $ne: 'PAID' } })`
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—á–µ—Ç–∞ –≤—ã—á–∏—Å–ª–∏—Ç–µ: `outstandingAmount = totalAmount - paidAmount`
3. –°—É–º–º–∏—Ä—É–π—Ç–µ –≤—Å–µ `outstandingAmount`, –≥–¥–µ `outstandingAmount > 0`
4. –°—Ä–∞–≤–Ω–∏—Ç–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º API

**–ü—Ä–∏–º–µ—Ä:**
- –°—á–µ—Ç 1: totalAmount = 10000, paidAmount = 3000 ‚Üí outstandingAmount = 7000 ‚úÖ
- –°—á–µ—Ç 2: totalAmount = 5000, paidAmount = 5000 ‚Üí outstandingAmount = 0 ‚ùå (–Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è)
- –°—á–µ—Ç 3: totalAmount = 8000, paidAmount = 0 ‚Üí outstandingAmount = 8000 ‚úÖ
- **–ò—Ç–æ–≥–æ**: totalReceivables = 7000 + 8000 = 15000

---

### 2. `overdueReceivables` (–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –î–ó)

**–§–æ—Ä–º—É–ª–∞:**
```
overdueReceivables = Œ£ (totalAmount - paidAmount)
–≥–¥–µ:
  - status != 'PAID'
  - outstandingAmount > 0
  - dueDate < —Ç–µ–∫—É—â–∞—è_–¥–∞—Ç–∞
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –í–æ–∑—å–º–∏—Ç–µ –≤—Å–µ —Å—á–µ—Ç–∞ –∏–∑ —Ä–∞—Å—á–µ—Ç–∞ `totalReceivables`
2. –û—Ç—Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ —Ç–µ, –≥–¥–µ `dueDate < new Date()` (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞)
3. –°—É–º–º–∏—Ä—É–π—Ç–µ –∏—Ö `outstandingAmount`

**–ü—Ä–∏–º–µ—Ä (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞: 14.11.2025):**
- –°—á–µ—Ç 1: outstandingAmount = 7000, dueDate = 10.10.2025 ‚Üí –ø—Ä–æ—Å—Ä–æ—á–µ–Ω ‚úÖ (7000)
- –°—á–µ—Ç 2: outstandingAmount = 8000, dueDate = 20.11.2025 ‚Üí –Ω–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω ‚ùå
- **–ò—Ç–æ–≥–æ**: overdueReceivables = 7000

---

### 3. `currentReceivables` (–î–ó –≤ —Å—Ä–æ–∫)

**–§–æ—Ä–º—É–ª–∞:**
```
currentReceivables = totalReceivables - overdueReceivables
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
–ü—Ä–æ—Å—Ç–æ –≤—ã—á—Ç–∏—Ç–µ `overdueReceivables` –∏–∑ `totalReceivables`

**–ü—Ä–∏–º–µ—Ä:**
- totalReceivables = 15000
- overdueReceivables = 7000
- **–ò—Ç–æ–≥–æ**: currentReceivables = 15000 - 7000 = 8000

---

### 4. `overduePercentage` (–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Å—Ä–æ—á–∫–∏)

**–§–æ—Ä–º—É–ª–∞:**
```
overduePercentage = (overdueReceivables / totalReceivables) √ó 100
–ï—Å–ª–∏ totalReceivables = 0, —Ç–æ overduePercentage = 0
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –í—ã—á–∏—Å–ª–∏—Ç–µ `overdueReceivables` –∏ `totalReceivables`
2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É–ª—É
3. –û–∫—Ä—É–≥–ª–∏—Ç–µ –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

**–ü—Ä–∏–º–µ—Ä:**
- overdueReceivables = 7000
- totalReceivables = 15000
- **–ò—Ç–æ–≥–æ**: overduePercentage = (7000 / 15000) √ó 100 = 46.67%

---

## üìä –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–∫–∏

### 5. `averagePaymentDelayDays` (–°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ –∑–∞–¥–µ—Ä–∂–∫–∏ –æ–ø–ª–∞—Ç—ã)

**–§–æ—Ä–º—É–ª–∞:**
```
averagePaymentDelayDays = —Å—Ä–µ–¥–Ω–µ–µ(daysOverdue)
–≥–¥–µ daysOverdue = —Ç–µ–∫—É—â–∞—è_–¥–∞—Ç–∞ - dueDate
–¥–ª—è –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤ –≥–¥–µ:
  - status != 'PAID'
  - outstandingAmount > 0
  - dueDate < —Ç–µ–∫—É—â–∞—è_–¥–∞—Ç–∞
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ —Å—á–µ—Ç–∞ (–∫–∞–∫ –≤ `overdueReceivables`)
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã—á–∏—Å–ª–∏—Ç–µ: `daysOverdue = Math.floor((—Å–µ–≥–æ–¥–Ω—è - dueDate) / (1000 * 60 * 60 * 24))`
3. –í—ã—á–∏—Å–ª–∏—Ç–µ —Å—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ –≤—Å–µ—Ö `daysOverdue`
4. –û–∫—Ä—É–≥–ª–∏—Ç–µ –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

**–ü—Ä–∏–º–µ—Ä (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞: 14.11.2025):**
- –°—á–µ—Ç 1: dueDate = 10.10.2025 ‚Üí daysOverdue = 35 –¥–Ω–µ–π
- –°—á–µ—Ç 2: dueDate = 01.11.2025 ‚Üí daysOverdue = 13 –¥–Ω–µ–π
- **–ò—Ç–æ–≥–æ**: averagePaymentDelayDays = (35 + 13) / 2 = 24.0 –¥–Ω—è

---

### 6. `totalInvoicesCount` (–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤)

**–§–æ—Ä–º—É–ª–∞:**
```
totalInvoicesCount = COUNT(*)
–≥–¥–µ:
  - status != 'PAID'
  - outstandingAmount > 0
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
–ü—Ä–æ—Å—Ç–æ –ø–æ—Å—á–∏—Ç–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ `totalReceivables`

**–ü—Ä–∏–º–µ—Ä:**
- –°—á–µ—Ç 1: outstandingAmount = 7000 ‚úÖ
- –°—á–µ—Ç 2: outstandingAmount = 0 ‚ùå
- –°—á–µ—Ç 3: outstandingAmount = 8000 ‚úÖ
- **–ò—Ç–æ–≥–æ**: totalInvoicesCount = 2

---

### 7. `overdueInvoicesCount` (–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤)

**–§–æ—Ä–º—É–ª–∞:**
```
overdueInvoicesCount = COUNT(*)
–≥–¥–µ:
  - status != 'PAID'
  - outstandingAmount > 0
  - dueDate < —Ç–µ–∫—É—â–∞—è_–¥–∞—Ç–∞
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
–ü–æ—Å—á–∏—Ç–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ `overdueReceivables`

**–ü—Ä–∏–º–µ—Ä:**
- –°—á–µ—Ç 1: outstandingAmount = 7000, dueDate = 10.10.2025 ‚úÖ (–ø—Ä–æ—Å—Ä–æ—á–µ–Ω)
- –°—á–µ—Ç 2: outstandingAmount = 8000, dueDate = 20.11.2025 ‚ùå (–Ω–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω)
- **–ò—Ç–æ–≥–æ**: overdueInvoicesCount = 1

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∞—Ä–µ–Ω–∏—è (Aging Structure)

### 8. Aging Buckets (–ö–æ—Ä–∑–∏–Ω—ã —Å—Ç–∞—Ä–µ–Ω–∏—è)

**–§–æ—Ä–º—É–ª–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ—Ä–∑–∏–Ω—ã:**
```
bucket_amount = Œ£ (outstandingAmount)
bucket_count = COUNT(*)
–≥–¥–µ:
  - status != 'PAID'
  - outstandingAmount > 0
  - daysOverdue –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω –∫–æ—Ä–∑–∏–Ω—ã
```

**–î–∏–∞–ø–∞–∑–æ–Ω—ã –∫–æ—Ä–∑–∏–Ω:**

| Bucket | –£—Å–ª–æ–≤–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| `Current` | `dueDate >= —Ç–µ–∫—É—â–∞—è_–¥–∞—Ç–∞` | –í —Å—Ä–æ–∫ (–Ω–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ) |
| `1-30` | `1 <= daysOverdue <= 30` | –ü—Ä–æ—Å—Ä–æ—á–∫–∞ 1-30 –¥–Ω–µ–π |
| `31-60` | `31 <= daysOverdue <= 60` | –ü—Ä–æ—Å—Ä–æ—á–∫–∞ 31-60 –¥–Ω–µ–π |
| `61-90` | `61 <= daysOverdue <= 90` | –ü—Ä–æ—Å—Ä–æ—á–∫–∞ 61-90 –¥–Ω–µ–π |
| `91+` | `daysOverdue > 90` | –ü—Ä–æ—Å—Ä–æ—á–∫–∞ –±–æ–ª–µ–µ 90 –¥–Ω–µ–π (–∫—Ä–∞—Å–Ω—ã–π —Å–µ–≥–º–µ–Ω—Ç) |

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ —Å—á–µ—Ç–∞ –≤—ã—á–∏—Å–ª–∏—Ç–µ `daysOverdue`
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ, –≤ –∫–∞–∫—É—é –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ø–∞–¥–∞–µ—Ç —Å—á–µ—Ç
3. –°—É–º–º–∏—Ä—É–π—Ç–µ `outstandingAmount` –ø–æ –∫–∞–∂–¥–æ–π –∫–æ—Ä–∑–∏–Ω–µ
4. –ü–æ—Å—á–∏—Ç–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–µ—Ç–æ–≤ –≤ –∫–∞–∂–¥–æ–π –∫–æ—Ä–∑–∏–Ω–µ

**–ü—Ä–∏–º–µ—Ä (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞: 14.11.2025):**

| –°—á–µ—Ç | outstandingAmount | dueDate | daysOverdue | Bucket |
|------|------------------|---------|-------------|--------|
| 1 | 5000 | 20.11.2025 | -6 | Current |
| 2 | 3000 | 10.11.2025 | 4 | 1-30 |
| 3 | 2000 | 10.10.2025 | 35 | 31-60 |
| 4 | 1000 | 01.08.2025 | 105 | 91+ |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "agingStructure": [
    { "bucket": "Current", "amount": 5000, "count": 1 },
    { "bucket": "1-30", "amount": 3000, "count": 1 },
    { "bucket": "31-60", "amount": 2000, "count": 1 },
    { "bucket": "61-90", "amount": 0, "count": 0 },
    { "bucket": "91+", "amount": 1000, "count": 1 }
  ]
}
```

---

## üí∞ –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏

### 9. `averageReceivables` (–°—Ä–µ–¥–Ω—è—è –î–ó –∑–∞ –ø–µ—Ä–∏–æ–¥)

**–§–æ—Ä–º—É–ª–∞:**
```
averageReceivables = (receivablesAtStart + receivablesAtEnd) / 2

–≥–¥–µ:
  receivablesAtStart = Œ£ (outstandingAmount) –Ω–∞ –Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    –¥–ª—è —Å—á–µ—Ç–æ–≤ –≥–¥–µ:
      - issueDate < –Ω–∞—á–∞–ª–æ_–º–µ—Å—è—Ü–∞
      - status != 'PAID'
      - outstandingAmount > 0

  receivablesAtEnd = Œ£ (outstandingAmount) –Ω–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
    –¥–ª—è —Å—á–µ—Ç–æ–≤ –≥–¥–µ:
      - status != 'PAID'
      - outstandingAmount > 0
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 01.11.2025)
2. –í—ã—á–∏—Å–ª–∏—Ç–µ `receivablesAtStart` - —Å—É–º–º—É –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –î–û –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞, –Ω–æ –µ—â–µ –Ω–µ –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö
3. –í—ã—á–∏—Å–ª–∏—Ç–µ `receivablesAtEnd` - —Ç–µ–∫—É—â—É—é `totalReceivables`
4. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É–ª—É
5. –û–∫—Ä—É–≥–ª–∏—Ç–µ –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

**–ü—Ä–∏–º–µ—Ä (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞: 14.11.2025, –Ω–∞—á–∞–ª–æ –º–µ—Å—è—Ü–∞: 01.11.2025):**

**–°—á–µ—Ç–∞ –Ω–∞ –Ω–∞—á–∞–ª–æ –º–µ—Å—è—Ü–∞ (—Å–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–æ 01.11.2025):**
- –°—á–µ—Ç 1: issueDate = 10.10.2025, outstandingAmount = 5000 ‚úÖ
- –°—á–µ—Ç 2: issueDate = 15.10.2025, outstandingAmount = 3000 ‚úÖ
- **receivablesAtStart** = 5000 + 3000 = 8000

**–°—á–µ—Ç–∞ –Ω–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É:**
- –°—á–µ—Ç 1: outstandingAmount = 5000 ‚úÖ
- –°—á–µ—Ç 2: outstandingAmount = 3000 ‚úÖ
- –°—á–µ—Ç 3: issueDate = 05.11.2025, outstandingAmount = 2000 ‚úÖ
- **receivablesAtEnd** = 5000 + 3000 + 2000 = 10000

**–ò—Ç–æ–≥–æ**: averageReceivables = (8000 + 10000) / 2 = 9000.00

---

### 10. `periodRevenue` (–í—ã—Ä—É—á–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥)

**–§–æ—Ä–º—É–ª–∞:**
```
periodRevenue = Œ£ (totalAmount)
–≥–¥–µ:
  - issueDate >= –Ω–∞—á–∞–ª–æ_—Ç–µ–∫—É—â–µ–≥–æ_–º–µ—Å—è—Ü–∞
  - issueDate <= —Ç–µ–∫—É—â–∞—è_–¥–∞—Ç–∞
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ —Å—á–µ—Ç–∞, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
2. –°—É–º–º–∏—Ä—É–π—Ç–µ –∏—Ö `totalAmount` (–Ω–µ `outstandingAmount`!)
3. –û–∫—Ä—É–≥–ª–∏—Ç–µ –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

**–ü—Ä–∏–º–µ—Ä (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞: 14.11.2025, –º–µ—Å—è—Ü: –Ω–æ—è–±—Ä—å 2025):**
- –°—á–µ—Ç 1: issueDate = 05.11.2025, totalAmount = 10000 ‚úÖ
- –°—á–µ—Ç 2: issueDate = 10.11.2025, totalAmount = 5000 ‚úÖ
- –°—á–µ—Ç 3: issueDate = 20.10.2025, totalAmount = 8000 ‚ùå (–Ω–µ –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ)
- **–ò—Ç–æ–≥–æ**: periodRevenue = 10000 + 5000 = 15000.00

---

### 11. `turnoverRatio` (–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏ –î–ó)

**–§–æ—Ä–º—É–ª–∞:**
```
turnoverRatio = periodRevenue / averageReceivables
–ï—Å–ª–∏ averageReceivables = 0, —Ç–æ turnoverRatio = 0
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –í—ã—á–∏—Å–ª–∏—Ç–µ `periodRevenue` –∏ `averageReceivables`
2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É–ª—É
3. –û–∫—Ä—É–≥–ª–∏—Ç–µ –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

**–ü—Ä–∏–º–µ—Ä:**
- periodRevenue = 15000
- averageReceivables = 9000
- **–ò—Ç–æ–≥–æ**: turnoverRatio = 15000 / 9000 = 1.67

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- `> 3` - –æ—Ç–ª–∏—á–Ω–æ (–±—ã—Å—Ç—Ä–∞—è –æ–ø–ª–∞—Ç–∞)
- `1-3` - –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- `< 1` - –ø–ª–æ—Ö–æ (–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–ø–ª–∞—Ç–∞)

---

## üìù –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π

### 12. `averagePaymentDays` (–°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã)

**–§–æ—Ä–º—É–ª–∞:**
```
averagePaymentDays = —Å—Ä–µ–¥–Ω–µ–µ(paymentDays)
–≥–¥–µ paymentDays = paymentDate - issueDate
–¥–ª—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –≤ PaymentHistory
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –í—ã–≥—Ä—É–∑–∏—Ç–µ –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ `db.paymenthistories.find()`
2. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –≤—ã—á–∏—Å–ª–∏—Ç–µ: `paymentDays = (paymentDate - issueDate) / (1000 * 60 * 60 * 24)`
3. –í—ã—á–∏—Å–ª–∏—Ç–µ —Å—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ –≤—Å–µ—Ö `paymentDays`
4. –û–∫—Ä—É–≥–ª–∏—Ç–µ –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

**–ü—Ä–∏–º–µ—Ä:**

| –ó–∞–ø–∏—Å—å | issueDate | paymentDate | paymentDays |
|--------|-----------|-------------|-------------|
| 1 | 10.09.2025 | 11.11.2025 | 62 –¥–Ω—è |
| 2 | 15.10.2025 | 13.11.2025 | 29 –¥–Ω–µ–π |

**–ò—Ç–æ–≥–æ**: averagePaymentDays = (62 + 29) / 2 = 45.5 –¥–Ω–µ–π

---

### 13. `onTimePaymentsAmount` (–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –≤ —Å—Ä–æ–∫)

**–§–æ—Ä–º—É–ª–∞:**
```
onTimePaymentsAmount = Œ£ (amount)
–≥–¥–µ:
  - isOnTime = true
  –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –≤ PaymentHistory
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –í—ã–≥—Ä—É–∑–∏—Ç–µ –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ `db.paymenthistories.find({ isOnTime: true })`
2. –°—É–º–º–∏—Ä—É–π—Ç–µ –ø–æ–ª–µ `amount`

**–ü—Ä–∏–º–µ—Ä:**

| –ó–∞–ø–∏—Å—å | amount | isOnTime |
|--------|--------|----------|
| 1 | 5000 | true ‚úÖ |
| 2 | 3000 | false ‚ùå |
| 3 | 2000 | true ‚úÖ |

**–ò—Ç–æ–≥–æ**: onTimePaymentsAmount = 5000 + 2000 = 7000

---

### 14. `overduePaymentsPercentage` (–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π)

**–§–æ—Ä–º—É–ª–∞:**
```
overduePaymentsPercentage = (overduePaymentsAmount / totalPaymentsAmount) √ó 100

–≥–¥–µ:
  overduePaymentsAmount = Œ£ (amount) –≥–¥–µ isOnTime = false
  totalPaymentsAmount = Œ£ (amount) –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –í—ã—á–∏—Å–ª–∏—Ç–µ —Å—É–º–º—É –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π: `totalPaymentsAmount = Œ£ (amount)`
2. –í—ã—á–∏—Å–ª–∏—Ç–µ —Å—É–º–º—É –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π: `overduePaymentsAmount = Œ£ (amount) –≥–¥–µ isOnTime = false`
3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É–ª—É
4. –û–∫—Ä—É–≥–ª–∏—Ç–µ –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

**–ü—Ä–∏–º–µ—Ä:**

| –ó–∞–ø–∏—Å—å | amount | isOnTime |
|--------|--------|----------|
| 1 | 5000 | true |
| 2 | 3000 | false |
| 3 | 2000 | true |

- totalPaymentsAmount = 5000 + 3000 + 2000 = 10000
- overduePaymentsAmount = 3000
- **–ò—Ç–æ–≥–æ**: overduePaymentsPercentage = (3000 / 10000) √ó 100 = 30.0%

---

## üîç –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ë–î

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É Excel/Google Sheets** —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:
   - invoiceNumber
   - customerUnp
   - issueDate
   - dueDate
   - totalAmount
   - paidAmount
   - outstandingAmount (–≤—ã—á–∏—Å–ª—è–µ–º–æ–µ: totalAmount - paidAmount)
   - daysOverdue (–≤—ã—á–∏—Å–ª—è–µ–º–æ–µ: —Å–µ–≥–æ–¥–Ω—è - dueDate)
   - bucket (–≤—ã—á–∏—Å–ª—è–µ–º–æ–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ daysOverdue)

2. **–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –≤—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≤—Ä—É—á–Ω—É—é** –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º –≤—ã—à–µ

3. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ CSV** –≤ —Å–∏—Å—Ç–µ–º—É

4. **–°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã API** —Å –≤–∞—à–∏–º–∏ —Ä–∞—Å—á–µ—Ç–∞–º–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ MongoDB

```javascript
// 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ totalReceivables
db.invoices.aggregate([
  {
    $match: {
      status: { $ne: 'PAID' }
    }
  },
  {
    $addFields: {
      outstandingAmount: { $subtract: ['$totalAmount', '$paidAmount'] }
    }
  },
  {
    $match: {
      outstandingAmount: { $gt: 0 }
    }
  },
  {
    $group: {
      _id: null,
      totalReceivables: { $sum: '$outstandingAmount' }
    }
  }
])

// 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ overdueReceivables
db.invoices.aggregate([
  {
    $match: {
      status: { $ne: 'PAID' },
      dueDate: { $lt: new Date() } // —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞
    }
  },
  {
    $addFields: {
      outstandingAmount: { $subtract: ['$totalAmount', '$paidAmount'] }
    }
  },
  {
    $match: {
      outstandingAmount: { $gt: 0 }
    }
  },
  {
    $group: {
      _id: null,
      overdueReceivables: { $sum: '$outstandingAmount' }
    }
  }
])

// 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ aging buckets
db.invoices.aggregate([
  {
    $match: {
      status: { $ne: 'PAID' }
    }
  },
  {
    $addFields: {
      outstandingAmount: { $subtract: ['$totalAmount', '$paidAmount'] },
      daysOverdue: {
        $floor: {
          $divide: [
            { $subtract: [new Date(), '$dueDate'] },
            1000 * 60 * 60 * 24
          ]
        }
      }
    }
  },
  {
    $match: {
      outstandingAmount: { $gt: 0 }
    }
  },
  {
    $group: {
      _id: {
        $cond: [
          { $lt: ['$daysOverdue', 1] },
          'Current',
          {
            $cond: [
              { $lte: ['$daysOverdue', 30] },
              '1-30',
              {
                $cond: [
                  { $lte: ['$daysOverdue', 60] },
                  '31-60',
                  {
                    $cond: [
                      { $lte: ['$daysOverdue', 90] },
                      '61-90',
                      '91+'
                    ]
                  }
                ]
              }
            ]
          }
        ]
      },
      amount: { $sum: '$outstandingAmount' },
      count: { $sum: 1 }
    }
  }
])

// 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π
db.paymenthistories.aggregate([
  {
    $group: {
      _id: null,
      averagePaymentDays: { $avg: '$paymentDays' },
      onTimePaymentsAmount: {
        $sum: {
          $cond: ['$isOnTime', '$amount', 0]
        }
      },
      totalPaymentsAmount: { $sum: '$amount' },
      overduePaymentsAmount: {
        $sum: {
          $cond: [{ $eq: ['$isOnTime', false] }, '$amount', 0]
        }
      }
    }
  },
  {
    $addFields: {
      overduePaymentsPercentage: {
        $multiply: [
          {
            $divide: ['$overduePaymentsAmount', '$totalPaymentsAmount']
          },
          100
        ]
      }
    }
  }
])
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–î–∞—Ç—ã**: –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–Ω–æ–π –¥–∞—Ç–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞.

2. **–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ**: 
   - –ü—Ä–æ—Ü–µ–Ω—Ç—ã –æ–∫—Ä—É–≥–ª—è—é—Ç—Å—è –¥–æ 1-2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
   - –°—É–º–º—ã –æ–∫—Ä—É–≥–ª—è—é—Ç—Å—è –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
   - –î–Ω–∏ –æ–∫—Ä—É–≥–ª—è—é—Ç—Å—è –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

3. **–î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å**: 
   - –ï—Å–ª–∏ `totalReceivables = 0`, —Ç–æ `overduePercentage = 0`
   - –ï—Å–ª–∏ `averageReceivables = 0`, —Ç–æ `turnoverRatio = 0`
   - –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ PaymentHistory, —Ç–æ –≤—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏ = 0

4. **–°—Ç–∞—Ç—É—Å —Å—á–µ—Ç–∞**: 
   - –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—á–µ—Ç–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `!= 'PAID'`
   - –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ —Å—á–µ—Ç–∞ (`paidAmount >= totalAmount`) –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è

5. **–ü–µ—Ä–∏–æ–¥ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏**: 
   - –í—Å–µ–≥–¥–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞ **—Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü**
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∑–∞ –¥—Ä—É–≥–æ–π –ø–µ—Ä–∏–æ–¥, –∏–∑–º–µ–Ω–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—É—é –¥–∞—Ç—É –∏–ª–∏ –∫–æ–¥

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [API Dashboard Documentation](../docs/API_DASHBOARD_SUMMARY.md)
- [Payment History Implementation](../PAYMENT_HISTORY_IMPLEMENTATION.md)
- [Test Data README](./README.md)

