# ‚ö†Ô∏è –í–ê–ñ–ù–û: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —ç–≤–æ–ª—é—Ü–∏–∏ –£–ù–ü

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–°–∏—Å—Ç–µ–º–∞ –∏–º–µ–µ—Ç **–∑–∞—â–∏—Ç—É –æ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö**, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–¥–≤–∏–≥–∞–µ—Ç –≤—Å–µ –ø—Ä–æ—à–ª—ã–µ –¥–∞—Ç—ã –Ω–∞ –≥–æ–¥ –≤–ø–µ—Ä–µ–¥. –≠—Ç–æ **—Å–ª–æ–º–∞–µ—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é** —ç–≤–æ–ª—é—Ü–∏–∏ –î–ó!

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- –í—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∞–∑–∞—Ç—å —Å—á–µ—Ç —Å –ø—Ä–æ—Å—Ä–æ—á–∫–æ–π 10.10.2025
- –°–∏—Å—Ç–µ–º–∞ –≤–∏–¥–∏—Ç, —á—Ç–æ 10.10.2025 < 14.11.2025 (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞)
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–¥–≤–∏–≥–∞–µ—Ç –Ω–∞ –≥–æ–¥ ‚Üí 10.10.2026
- –†–µ–∑—É–ª—å—Ç–∞—Ç: —Å—á–µ—Ç **–Ω–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω** ‚ùå

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–¥–≤–∏–≥ –ø–µ—Ä–µ–¥ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª

```
src/application/use-cases/data-uploads/process-1c-invoice-upload.use-case.ts
```

### –®–∞–≥ 2: –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ 350-363

```typescript
        } else {
            // –î–ª—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö: –µ—Å–ª–∏ –¥–∞—Ç–∞ –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–π –æ–ø–ª–∞—Ç—ã –≤ –ø—Ä–æ—à–ª–æ–º, —Å–¥–≤–∏–≥–∞–µ–º –µ–µ –≤ –±—É–¥—É—â–µ–µ
            // —á—Ç–æ–±—ã —Å—á–µ—Ç –Ω–µ –±—ã–ª –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–º –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            const today = new Date();
            if (dueDate < today) {
                // –°–¥–≤–∏–≥–∞–µ–º –¥–∞—Ç—É –Ω–∞ –≥–æ–¥ –≤–ø–µ—Ä–µ–¥, —Å–æ—Ö—Ä–∞–Ω—è—è –º–µ—Å—è—Ü –∏ –¥–µ–Ω—å
                const futureDueDate = new Date(dueDate);
                futureDueDate.setFullYear(futureDueDate.getFullYear() + 1);
                // –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Å–¥–≤–∏–≥–∞ –¥–∞—Ç–∞ –≤—Å–µ –µ—â–µ –≤ –ø—Ä–æ—à–ª–æ–º (—Ä–µ–¥–∫–∏–π —Å–ª—É—á–∞–π), —Å–¥–≤–∏–≥–∞–µ–º –µ—â–µ –Ω–∞ –≥–æ–¥
                if (futureDueDate < today) {
                    futureDueDate.setFullYear(futureDueDate.getFullYear() + 1);
                }
                dueDate = futureDueDate;
            }
        }
```

### –®–∞–≥ 3: –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏–∫—É —Å–¥–≤–∏–≥–∞

```typescript
        } else {
            // –í–†–ï–ú–ï–ù–ù–û –û–¢–ö–õ–Æ–ß–ï–ù–û –î–õ–Ø –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–ò –≠–í–û–õ–Æ–¶–ò–ò –î–ó
            // –î–ª—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö: –µ—Å–ª–∏ –¥–∞—Ç–∞ –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–π –æ–ø–ª–∞—Ç—ã –≤ –ø—Ä–æ—à–ª–æ–º, —Å–¥–≤–∏–≥–∞–µ–º –µ–µ –≤ –±—É–¥—É—â–µ–µ
            // —á—Ç–æ–±—ã —Å—á–µ—Ç –Ω–µ –±—ã–ª –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–º –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            // const today = new Date();
            // if (dueDate < today) {
            //     // –°–¥–≤–∏–≥–∞–µ–º –¥–∞—Ç—É –Ω–∞ –≥–æ–¥ –≤–ø–µ—Ä–µ–¥, —Å–æ—Ö—Ä–∞–Ω—è—è –º–µ—Å—è—Ü –∏ –¥–µ–Ω—å
            //     const futureDueDate = new Date(dueDate);
            //     futureDueDate.setFullYear(futureDueDate.getFullYear() + 1);
            //     // –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Å–¥–≤–∏–≥–∞ –¥–∞—Ç–∞ –≤—Å–µ –µ—â–µ –≤ –ø—Ä–æ—à–ª–æ–º (—Ä–µ–¥–∫–∏–π —Å–ª—É—á–∞–π), —Å–¥–≤–∏–≥–∞–µ–º –µ—â–µ –Ω–∞ –≥–æ–¥
            //     if (futureDueDate < today) {
            //         futureDueDate.setFullYear(futureDueDate.getFullYear() + 1);
            //     }
            //     dueDate = futureDueDate;
            // }
        }
```

### –®–∞–≥ 4: –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç

```bash
npm run build
```

### –®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

```bash
npm run start
# –∏–ª–∏
npm run dev
```

### –®–∞–≥ 6: –ü–æ—Å–ª–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –í–ï–†–ù–ò–¢–ï –∫–æ–¥ –æ–±—Ä–∞—Ç–Ω–æ

**–í–ê–ñ–ù–û**: –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –ø–æ—Å–ª–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏, –∏–Ω–∞—á–µ –≤—Å–µ —Å—Ç–∞—Ä—ã–µ CSV —Ñ–∞–π–ª—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ —Å—á–µ—Ç–∞!

---

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ —Å—á–µ—Ç–æ–≤

–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å –∫–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ–∞–π–ª—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏ —Å—á–µ—Ç–æ–≤:
- `06_unp12345678_stage1_alt.csv` (–ê–ö–¢-2025-UNP-01)
- `06_unp12345678_stage2_alt.csv` (–ê–ö–¢-2025-UNP-02)
- `06_unp12345678_stage3_alt.csv` (–ê–ö–¢-2025-UNP-03)
- –∏ —Ç.–¥.

–ö–∞–∂–¥—ã–π —ç—Ç–∞–ø —Å–æ–∑–¥–∞—Å—Ç –ù–û–í–´–ô —Å—á–µ—Ç, –∏ –ø—Ä–æ—Å—Ä–æ—á–∫–∞ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ—Å–¥–≤–∏–≥–∞).

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ—Å–¥–≤–∏–≥–∞

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ `06_unp12345678_stage1.csv`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ë–î:
   ```javascript
   db.invoices.findOne({ invoiceNumber: "–ê–ö–¢-2025-UNP-01" })
   ```
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `dueDate`:
   - ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `2025-10-10T00:00:00.000Z`
   - ‚ùå –ï—Å–ª–∏: `2026-10-10T00:00:00.000Z` ‚Üí –∞–≤—Ç–æ—Å–¥–≤–∏–≥ –í–°–ï –ï–©–ï –í–ö–õ–Æ–ß–ï–ù!

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–∫–∏

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ `06_unp12345678_stage2.csv`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Dashboard:
   ```bash
   GET /api/v1/reports/dashboard/summary
   ```
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - `overdueReceivables` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0
   - `agingStructure` –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—á–µ—Ç –≤ bucket `1-30`

---

## üéØ –ü–æ—Ä—è–¥–æ–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–¥–µ–ª–∞–µ—Ç—Å—è –û–î–ò–ù —Ä–∞–∑ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º):
1. ‚úÖ –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–¥–≤–∏–≥ (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥)
2. ‚úÖ –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç (`npm run build`)
3. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
4. ‚úÖ –û—á–∏—Å—Ç–∏—Ç—å –ë–î –æ—Ç —Å—Ç–∞—Ä—ã—Ö —Å—á–µ—Ç–æ–≤ –£–ù–ü 12345678
   ```javascript
   db.invoices.deleteMany({ "customer.unp": "12345678" })
   db.customers.deleteOne({ unp: "12345678" })
   db.paymenthistories.deleteMany({ inn: "12345678" })
   ```

### –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è:
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å `06_unp12345678_stage1.csv`
   - –ü–æ–∫–∞–∑–∞—Ç—å: –î–ó –ø–æ—è–≤–∏–ª–∞—Å—å, –ø—Ä–æ—Å—Ä–æ—á–∫–∏ –Ω–µ—Ç
2. **–£–î–ê–õ–ò–¢–¨ —Å—á–µ—Ç –∏–∑ –ë–î** (—Å–º. –Ω–∏–∂–µ)
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å `06_unp12345678_stage2.csv`
   - –ü–æ–∫–∞–∑–∞—Ç—å: –ø—Ä–æ—Å—Ä–æ—á–∫–∞ 5000, bucket 1-30
4. **–£–î–ê–õ–ò–¢–¨ —Å—á–µ—Ç –∏–∑ –ë–î**
5. –ó–∞–≥—Ä—É–∑–∏—Ç—å `06_unp12345678_stage3.csv`
   - –ü–æ–∫–∞–∑–∞—Ç—å: –æ—Å—Ç–∞—Ç–æ–∫ 2000, bucket 31-60, –∑–∞–ø–∏—Å—å –≤ PaymentHistory
6. **–£–î–ê–õ–ò–¢–¨ —Å—á–µ—Ç –∏–∑ –ë–î**
7. –ó–∞–≥—Ä—É–∑–∏—Ç—å `06_unp12345678_stage4_full_payment.csv` –ò–õ–ò `stage4_red_bucket.csv`
   - –ü–æ–∫–∞–∑–∞—Ç—å: –ø–æ–ª–Ω–æ–µ –ø–æ–≥–∞—à–µ–Ω–∏–µ –ò–õ–ò –∫—Ä–∞—Å–Ω—ã–π —Å–µ–≥–º–µ–Ω—Ç

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞ –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏:
```javascript
// –ù–∞–π—Ç–∏ ID —Å—á–µ—Ç–∞
const invoice = db.invoices.findOne({ invoiceNumber: "–ê–ö–¢-2025-UNP-01" });

// –£–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç
db.invoices.deleteOne({ _id: invoice._id });

// –£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
db.paymenthistories.deleteMany({ invoiceId: invoice._id });
```

---

## ‚ö†Ô∏è –ü–æ—á–µ–º—É –Ω—É–∂–Ω–æ —É–¥–∞–ª—è—Ç—å —Å—á–µ—Ç –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏?

–ü–æ—Ç–æ–º—É —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞** (`–ê–ö–¢-2025-UNP-01`).

–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ:
- –ï—Å–ª–∏ `paidAmount` –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å ‚Üí —Å—á–µ—Ç **–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è**
- –ï—Å–ª–∏ `paidAmount` –∏–∑–º–µ–Ω–∏–ª–∞—Å—å ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞, –Ω–æ **`dueDate` –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è**

–ü–æ—ç—Ç–æ–º—É –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–∑–Ω—ã—Ö –¥–∞—Ç –ø—Ä–æ—Å—Ä–æ—á–∫–∏ –Ω—É–∂–Ω–æ –ª–∏–±–æ:
- –£–¥–∞–ª—è—Ç—å —Å—á–µ—Ç –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏ ‚úÖ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ —Å—á–µ—Ç–æ–≤ (—Å–º. –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤—ã—à–µ)

---

## üîß –ü–æ—Å–ª–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏: –í–µ—Ä–Ω—É—Ç—å –∫–æ–¥ –æ–±—Ä–∞—Ç–Ω–æ

**–ù–ï –ó–ê–ë–£–î–¨–¢–ï** —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Å–¥–≤–∏–≥ –ø–æ—Å–ª–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏!

1. –û—Ç–∫—Ä–æ–π—Ç–µ `process-1c-invoice-upload.use-case.ts`
2. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ 350-363
3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ: `npm run build`
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

---

## üìù –†–µ–∑—é–º–µ

**–î–ª—è —É—Å–ø–µ—à–Ω–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ:**
1. ‚úÖ –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–¥–≤–∏–≥ –¥–∞—Ç –≤ –∫–æ–¥–µ
2. ‚úÖ –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
3. ‚úÖ –£–¥–∞–ª—è—Ç—å —Å—á–µ—Ç –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏
4. ‚úÖ –í–µ—Ä–Ω—É—Ç—å –∫–æ–¥ –æ–±—Ä–∞—Ç–Ω–æ –ø–æ—Å–ª–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å –∫–æ–¥):**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ —Å—á–µ—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ (—Å–æ–∑–¥–∞–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã)

