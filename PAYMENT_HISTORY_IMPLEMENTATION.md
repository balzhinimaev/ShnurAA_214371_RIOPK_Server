# üìä –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∏ –Ω–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –°—Ö–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π (`PaymentHistory`)

–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π:

**–§–∞–π–ª**: `src/infrastructure/database/mongoose/schemas/payment-history.schema.ts`

**–ü–æ–ª—è**:
- `invoiceId` - —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—á–µ—Ç
- `amount` - —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
- `paymentDate` - –¥–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
- `isOnTime` - –±—ã–ª –ª–∏ –ø–ª–∞—Ç–µ–∂ –≤ —Å—Ä–æ–∫ (paymentDate <= dueDate)
- `daysDelay` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (–µ—Å–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω)

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π

**–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—á–µ—Ç–∞** (`create`):
- –ï—Å–ª–∏ —Å—á–µ—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å —É–∂–µ –∏–º–µ—é—â–µ–π—Å—è –æ–ø–ª–∞—Ç–æ–π (`paidAmount > 0` –∏ `actualPaymentDate` —É–∫–∞–∑–∞–Ω–∞)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `PaymentHistory`
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è `isOnTime` –∏ `daysDelay`

**–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã** (`updatePayment`):
- –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Å—Ç–∞—Ä—ã–º –∏ –Ω–æ–≤—ã–º `paidAmount`
- –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ > 0, —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ `PaymentHistory`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ **–Ω–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂** (—Ä–∞–∑–Ω–∏—Ü–∞), –∞ –Ω–µ –≤—Å—è —Å—É–º–º–∞

### 3. –ù–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ Dashboard

–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç—Ä–∏ –Ω–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π:

#### 3.1. –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã (`averagePaymentDays`)

**–§–æ—Ä–º—É–ª–∞**: –°—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ –¥–Ω–µ–π –æ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞ (`issueDate`) –¥–æ –æ–ø–ª–∞—Ç—ã (`paymentDate`)

**–ü—Ä–∏–º–µ—Ä**:
```
–°—á–µ—Ç 1: –≤—ã—Å—Ç–∞–≤–ª–µ–Ω 01.09, –æ–ø–ª–∞—á–µ–Ω 15.09 ‚Üí 14 –¥–Ω–µ–π
–°—á–µ—Ç 2: –≤—ã—Å—Ç–∞–≤–ª–µ–Ω 01.10, –æ–ø–ª–∞—á–µ–Ω 25.10 ‚Üí 24 –¥–Ω—è
–°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ = (14 + 24) / 2 = 19 –¥–Ω–µ–π
```

#### 3.2. –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –≤ —Å—Ä–æ–∫ (`onTimePaymentsAmount`)

**–§–æ—Ä–º—É–ª–∞**: –°—É–º–º–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π, –≥–¥–µ `paymentDate <= dueDate`

**–ü—Ä–∏–º–µ—Ä**:
```
–ü–ª–∞—Ç–µ–∂ 1: 10000 —Ä—É–±., paymentDate=10.10, dueDate=15.10 ‚Üí –≤ —Å—Ä–æ–∫ ‚Üí +10000
–ü–ª–∞—Ç–µ–∂ 2: 5000 —Ä—É–±., paymentDate=20.10, dueDate=15.10 ‚Üí –ø—Ä–æ—Å—Ä–æ—á–µ–Ω ‚Üí +0
–ü–ª–∞—Ç–µ–∂ 3: 8000 —Ä—É–±., paymentDate=12.10, dueDate=15.10 ‚Üí –≤ —Å—Ä–æ–∫ ‚Üí +8000
–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –≤ —Å—Ä–æ–∫ = 18000 —Ä—É–±.
```

#### 3.3. –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π (`overduePaymentsPercentage`)

**–§–æ—Ä–º—É–ª–∞**: `(–°—É–º–º–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π / –û–±—â–∞—è —Å—É–º–º–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π) √ó 100`

**–ü—Ä–∏–º–µ—Ä**:
```
–û–±—â–∞—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π = 50000 —Ä—É–±.
–°—É–º–º–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö = 15000 —Ä—É–±.
–ü—Ä–æ—Ü–µ–Ω—Ç = (15000 / 50000) √ó 100 = 30%
```

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Å—á–µ—Ç–∞ —Å –æ–ø–ª–∞—Ç–æ–π

```csv
–ù–æ–º–µ—Ä_–∞–∫—Ç–∞,–°—É–º–º–∞_–∫_–æ–ø–ª–∞—Ç–µ,–°—É–º–º–∞_–æ–ø–ª–∞—á–µ–Ω–æ,–î–∞—Ç–∞_—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π_–æ–ø–ª–∞—Ç—ã,–î–∞—Ç–∞_–ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–π_–æ–ø–ª–∞—Ç—ã
–ê–ö–¢-001,10000,5000,10.10.2024,15.10.2024
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
1. –°–æ–∑–¥–∞–µ—Ç—Å—è —Å—á–µ—Ç —Å `paidAmount = 5000`
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `PaymentHistory`:
   ```json
   {
     "invoiceId": "...",
     "amount": 5000,
     "paymentDate": "2024-10-10",
     "isOnTime": true,  // 10.10 <= 15.10
     "daysDelay": 0
   }
   ```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ß–∞—Å—Ç–∏—á–Ω–æ–µ –ø–æ–≥–∞—à–µ–Ω–∏–µ

**–ë—ã–ª–æ**: `paidAmount = 5000`  
**–°—Ç–∞–ª–æ**: `paidAmount = 8000` (–¥–æ–ø–ª–∞—Ç–∏–ª–∏ 3000)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
1. –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ä–∞–∑–Ω–∏—Ü–∞: `8000 - 5000 = 3000`
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ `PaymentHistory`:
   ```json
   {
     "invoiceId": "...",
     "amount": 3000,  // –¢–æ–ª—å–∫–æ –Ω–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂!
     "paymentDate": "2024-11-10",
     "isOnTime": false,  // 10.11 > 15.10 (–ø—Ä–æ—Å—Ä–æ—á–µ–Ω)
     "daysDelay": 26  // 10.11 - 15.10 = 26 –¥–Ω–µ–π
   }
   ```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –†–∞—Å—á–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ Dashboard (`GET /api/v1/reports/dashboard/summary`):

1. **–°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã**: –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ `PaymentHistory`, –≤—ã—á–∏—Å–ª—è–µ—Ç `paymentDays = paymentDate - issueDate`, –±–µ—Ä–µ—Ç —Å—Ä–µ–¥–Ω–µ–µ

2. **–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –≤ —Å—Ä–æ–∫**: –§–∏–ª—å—Ç—Ä—É–µ—Ç –∑–∞–ø–∏—Å–∏ –≥–¥–µ `isOnTime = true`, —Å—É–º–º–∏—Ä—É–µ—Ç `amount`

3. **–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö**: –í—ã—á–∏—Å–ª—è–µ—Ç `(—Å—É–º–º–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö / –æ–±—â–∞—è —Å—É–º–º–∞) √ó 100`

---

## üìã API Response

–¢–µ–ø–µ—Ä—å Dashboard –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:

```json
{
  "totalReceivables": 50000,
  "overdueReceivables": 20000,
  "overduePercentage": 40,
  "currentReceivables": 30000,
  "averagePaymentDelayDays": 15.5,
  "totalInvoicesCount": 10,
  "overdueInvoicesCount": 4,
  "agingStructure": [...],
  "averageReceivables": 45000,
  "turnoverRatio": 2.5,
  "periodRevenue": 112500,
  
  // ‚¨áÔ∏è –ù–û–í–´–ï –ü–û–õ–Ø ‚¨áÔ∏è
  "averagePaymentDays": 28.5,           // –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã
  "onTimePaymentsAmount": 85000,        // –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –≤ —Å—Ä–æ–∫
  "overduePaymentsPercentage": 15.3      // % –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
}
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è**: –ö–∞–∂–¥—ã–π –ø–ª–∞—Ç–µ–∂ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ  
‚úÖ **–¢–æ—á–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã**: –ú–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ –ø–ª–∞—Ç–µ–∂–∏ –±—ã–ª–∏ –≤ —Å—Ä–æ–∫, –∞ –∫–∞–∫–∏–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω—ã  
‚úÖ **–î–∏–Ω–∞–º–∏–∫–∞**: –ú–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–∏  
‚úÖ **–ê—É–¥–∏—Ç**: –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—á–µ—Ç–∞  

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞ —Å –æ–ø–ª–∞—Ç–æ–π

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —Å –æ–ø–ª–∞—á–µ–Ω–Ω—ã–º —Å—á–µ—Ç–æ–º:
   ```csv
   –î–∞—Ç–∞_–Ω–∞—á–∞–ª–∞_—É—Å–ª—É–≥–∏,–î–∞—Ç–∞_–æ–∫–æ–Ω—á–∞–Ω–∏—è_—É—Å–ª—É–≥–∏,–ù–æ–º–µ—Ä_–∞–∫—Ç–∞,–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç,–ò–ù–ù,–°—É–º–º–∞_–∫_–æ–ø–ª–∞—Ç–µ,–î–∞—Ç–∞_–ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–π_–æ–ø–ª–∞—Ç—ã,–°—É–º–º–∞_–æ–ø–ª–∞—á–µ–Ω–æ,–î–∞—Ç–∞_—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π_–æ–ø–ª–∞—Ç—ã
   01.09.2024,01.10.2024,–ê–ö–¢-001,–û–û–û "–¢–µ—Å—Ç",11111111,10000,15.10.2024,10000,10.10.2024
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Dashboard - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
   - `averagePaymentDays` > 0
   - `onTimePaymentsAmount` = 10000
   - `overduePaymentsPercentage` = 0

### –¢–µ—Å—Ç 2: –ß–∞—Å—Ç–∏—á–Ω–æ–µ –ø–æ–≥–∞—à–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—Ä–æ—á–∫–æ–π

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–æ—Ç –∂–µ —Å—á–µ—Ç, –Ω–æ —Å —á–∞—Å—Ç–∏—á–Ω–æ–π –æ–ø–ª–∞—Ç–æ–π:
   ```csv
   ...,–ê–ö–¢-001,...,10000,15.10.2024,5000,20.10.2024
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Dashboard:
   - `onTimePaymentsAmount` = 0 (–ø–ª–∞—Ç–µ–∂ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω)
   - `overduePaymentsPercentage` > 0

### –¢–µ—Å—Ç 3: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å—á–µ—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏ (—á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–æ–∫):
   - –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: `paidAmount = 3000, paymentDate = 10.10` (–≤ —Å—Ä–æ–∫)
   - –í—Ç–æ—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: `paidAmount = 8000, paymentDate = 20.10` (–ø—Ä–æ—Å—Ä–æ—á–µ–Ω)

2. –í `PaymentHistory` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 2 –∑–∞–ø–∏—Å–∏:
   - –ó–∞–ø–∏—Å—å 1: amount=3000, isOnTime=true
   - –ó–∞–ø–∏—Å—å 2: amount=5000, isOnTime=false

---

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ò—Å—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** - –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å–∏
2. **–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä–∞–∑–Ω–∏—Ü–∞** - —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–ª–∞—Ç–µ–∂
3. **–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –ª–µ—Ç—É** - –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ Dashboard
4. **–ï—Å–ª–∏ –ø–ª–∞—Ç–µ–∂–µ–π –Ω–µ—Ç** - –≤—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ = 0

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ç—Ä–µ–±—É–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- ‚úÖ –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã
- ‚úÖ –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –≤ —Å—Ä–æ–∫  
- ‚úÖ –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è –∞—É–¥–∏—Ç–∞

